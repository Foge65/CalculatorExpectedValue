<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FS Profit Calc</title>
    <link rel="stylesheet" href="css.css">
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">

<body>
<div id="rooms">
    <a>Room:</a>
    <label for="room"></label>
    <select id="room" onchange="setValueOnChange('/calcEV/setRoom', 'room', this)"></select>
</div>

<div id="buyIns">
    <a>BuyIn:</a>
    <label for="buyIn"></label>
    <select id="buyIn" onchange="setValueOnChange('/calcEV/setBuyIn', 'buyIn', this)"></select>
</div>

<div id="rakes">
    <a>Rake:</a>
    <label for="rake"></label>
    <select id="rake" onchange="setValueOnChange('/calcEV/setRake', 'rake', this)"></select>
</div>

<a>Tournaments:</a>
<label for="tournaments"></label>
<input id="tournaments" oninput="setValueOnInput('tournaments', '/calcEV/setTournaments', 'tourney')" type="text">
<p></p>

<a>ChipsEV:</a>
<label for="chipsEV"></label>
<input id="chipsEV" oninput="setValueOnInput('chipsEV', '/calcEV/setChipsEV', 'chipsEV')" type="text">
<p></p>

<a><b>HyperEV:</b></a>
<label for="hyperEV"></label>
<input type="text" id="hyperEV" readonly>
<p></p>

<hr style="width:50%;text-align:left;margin-left:0">

<a>Tables:</a>
<label for="tables"></label>
<input id="tables" oninput="setValueOnInput('tables', '/calcEV/setTables', 'tables')" type="text">
<p></p>

<a>Tables Per Hour:</a>
<label for="tablesPerHour"></label>
<input id="tablesPerHour" oninput="setValueOnInput('tablesPerHour', '/calcEV/setTablesPerHour', 'tables')" type="text">
<p></p>

<a>$EV Per Tourney:</a>
<label for="dollarsEVPerTourney"></label>
<input id="dollarsEVPerTourney"
       oninput="setValueOnInput('dollarsEVPerTourney', '/calcEV/setDollarsEVPerTourney', 'dollars')">
<p></p>

<hr style="width:50%;text-align:left;margin-left:0">

<a>Dollars Per Hour:</a>
<label for="dollarsPerHour"></label>
<input type="text" id="dollarsPerHour"
       oninput="setValueOnInput('dollarsPerHour', '/calcEV/setDollarsPerHour', 'dollars')">
<p></p>

<a>Hours Per Day:</a>
<label for="hoursPerDay"></label>
<input id="hoursPerDay" oninput="setValueOnInput('hoursPerDay', '/calcEV/setHoursPerDay', 'hours')" type="text">
<p></p>

<a>Days Per Month:</a>
<label for="daysPerMonth"></label>
<input id="daysPerMonth" oninput="setValueOnInput('daysPerMonth', '/calcEV/setDaysPerMonth', 'days')" type="text">
<p></p>

<a><b>$EV Total:</b></a>
<label for="evTotal"></label>
<input type="text" id="evTotal" readonly>
<p></p>

<hr style="width:50%;text-align:left;margin-left:0">

<a>RackBack, %:</a>
<label for="rakeBack"></label>
<input id="rakeBack" oninput="setValueOnInput('rakeBack', '/calcEV/setRakeBack', 'rakeBack')">
<p></p>

<a>Other Payments, $:</a>
<label for="otherPayments"></label>
<input id="otherPayments" oninput="setValueOnInput('otherPayments', '/calcEV/setOtherBonuses', 'dollars')">
<p></p>

<a><b>Profit Total:</b></a>
<label for="profitTotal"></label>
<input id="profitTotal" readonly>
<p></p>

<hr style="width:50%;text-align:left;margin-left:0">

<script>
    getData('/calcEV/getRooms', data => {
        buildList(data, "room");
        setValueOnChange('/calcEV/setRoom', 'room', document.getElementById("room"));
    });

    getData('/calcEV/getBuyIns', data => {
        buildList(data, "buyIn");
        setValueOnChange('/calcEV/setBuyIn', 'buyIn', document.getElementById("buyIn"));
    });

    getData('/calcEV/getRakes', data => {
        buildList(data, "rake");
        setValueOnChange('/calcEV/setRake', 'rake', document.getElementById("rake"));
    });

    function getData(url, callback) {
        let request = new XMLHttpRequest();
        request.onreadystatechange = () => {
            if (request.readyState === XMLHttpRequest.DONE) {
                let data = JSON.parse(request.responseText);
                callback(data);
            }
        };
        request.open('GET', url, true);
        request.send();
    }

    function buildList(data, id) {
        let element = document.getElementById(id);
        data.forEach(item => {
            let option = document.createElement("option");
            option.value = item;
            option.textContent = item;
            element.appendChild(option);
        });
    }

    function setValueOnChange(request, requestParam, value) {
        let url = `${request}?${requestParam}=${encodeURIComponent(value.value)}`;
        fetch(url, {
            method: 'POST',
        }).then(() => {
            getValue('/calcEV/hyperEV', 'hyperEV');
            getValue('/calcEV/evTotal', 'evTotal');
            getValue('/calcEV/profitTotal', 'profitTotal');
        });
    }

    function setValueOnInput(id, request, requestParam) {
        let value = document.getElementById(id).value;
        if (value.trim() !== '' && /^\d*\.?\d*$/.test(value)) {
            let form = new FormData();
            form.append(requestParam, value);

            fetch(request, {
                method: 'POST',
                body: form
            }).then(() => {
                getValue('/calcEV/hyperEV', 'hyperEV');
                getValue('/calcEV/evTotal', 'evTotal');
                getValue('/calcEV/profitTotal', 'profitTotal');
            });
        }
    }

    document.addEventListener("DOMContentLoaded", () => {
        const fields = [
            "tournaments",
            "chipsEV",
            "tables",
            "tablesPerHour",
            "dollarsEVPerTourney",
            "dollarsPerHour",
            "hoursPerDay",
            "daysPerMonth",
            "rakeBack",
            "otherPayments",
        ];

        fields.forEach(fieldId => {
            const field = document.getElementById(fieldId);
            if (field) {
                field.value = "0";
            }
        });

        getValue('/calcEV/hyperEV', 'hyperEV');
        getValue('/calcEV/evTotal', 'evTotal');
        getValue('/calcEV/profitTotal', 'profitTotal');
    });

    function getValue(request, id) {
        fetch(request)
            .then(response => response.text())
            .then(data => {
                document.getElementById(id).value = data;
            })
    }

</script>
</body>
</html>
