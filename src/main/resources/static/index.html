<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FS Profit Calc</title>
    <link rel="stylesheet" href="css.css">
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">

<body>
<div id="rooms">
    <a>Room:</a>
    <label for="room"></label>
    <select id="room" onchange="setValueOnChange('/calcEV/setRoom', 'room', this)"></select>
</div>

<div id="buyIns">
    <a>BuyIn:</a>
    <label for="buyIn"></label>
    <select id="buyIn" onchange="setValueOnChange('/calcEV/setBuyIn', 'buyIn', this)"></select>
</div>

<div id="rakes">
    <a>Rake:</a>
    <label for="rake"></label>
    <select id="rake" onchange="setValueOnChange('/calcEV/setRake', 'rake', this)"></select>
</div>

<a class="inline">Tournaments:</a>
<label for="tournaments"></label>
<input type="text" id="tournaments"
       oninput="setValueOnInput('tournaments', '/calcEV/setTournaments', 'tourney')">
<p id="outputTournaments"></p>

<a class="inline">ChipsEV:</a>
<label for="chipsEV"></label>
<input type="text" id="chipsEV"
       oninput="setValueOnInput('chipsEV', '/calcEV/setChipsEV', 'chipsEV')">
<p id="outputChipsEV"></p>

<a class="inline">HyperEV:</a>
<label for="hyperEV"></label>
<input type="text" id="hyperEV" readonly>
<p id="outputHyperEV"></p>

<hr style="width:25%;text-align:left;margin-left:0">

<a class="inline">RackBack, %:</a>
<label for="rakeBack"></label>
<input type="text" id="rakeBack"
       oninput="setValueOnInput('rakeBack', '/calcEV/setRakeBack', 'rakeBack')">
<p id="outputRakeBack"></p>

<a class="inline">Tables:</a>
<label for="tables"></label>
<input type="text" id="tables"
       oninput="setValueOnInput('tables', '/calcEV/setTables', 'tables')">
<p id="outputTables"></p>

<a class="inline">Tables Per Hour:</a>
<label for="tablesPerHour"></label>
<input type="text" id="tablesPerHour"
       oninput="setValueOnInput('tablesPerHour', '/calcEV/setTablesPerHour', 'tables')">
<p id="outputTablesPerHour"></p>

<hr style="width:25%;text-align:left;margin-left:0">

<a class="inline">Dollars Per Hour:</a>
<label for="dollarsPerHour"></label>
<input type="text" id="dollarsPerHour"
       oninput="setValueOnInput('dollarsPerHour', '/calcEV/setDollarsPerHour', 'dollars')">
<p id="outputDollarsPerHour"></p>

<a class="inline">Hours Per Day:</a>
<label for="hoursPerDay"></label>
<input type="text" id="hoursPerDay"
       oninput="setValueOnInput('hoursPerDay', '/calcEV/setHoursPerDay', 'hours')">
<p id="outputHoursPerDay"></p>

<a class="inline">Days Per Month:</a>
<label for="daysPerMonth"></label>
<input type="text" id="daysPerMonth"
       oninput="setValueOnInput('daysPerMonth', '/calcEV/setDaysPerMonth', 'days')">
<p id="outputDaysPerMonth"></p>

<a class="inline">$EV Total:</a>
<label for="evTotal"></label>
<input type="text" id="evTotal" readonly>
<p id="outputEVTotal"></p>

<hr style="width:25%;text-align:left;margin-left:0">

<a class="inline">$EV Per Tourney:</a>
<label for="dollarsEVPerTourney"></label>
<input type="text" id="dollarsEVPerTourney"
       oninput="setValueOnInput('dollarsEVPerTourney', '/calcEV/setDollarsEVPerTourney', 'dollars')">
<p id="outputDollarsEVPerTourney"></p>

<hr style="width:25%;text-align:left;margin-left:0">

<script>
    getData('/calcEV/getRooms', param => {
        listElements(param, "room");

        document.getElementById("room").selectedIndex = 0;
        setValueOnChange('/calcEV/setRoom', 'room', document.getElementById("room"));
    });

    getData('/calcEV/getBuyIns', param => {
        listElements(param, "buyIn");

        document.getElementById("buyIn").selectedIndex = 0;
        setValueOnChange('/calcEV/setBuyIn', 'buyIn', document.getElementById("buyIn"));
    });

    getData('/calcEV/getRakes', param => {
        listElements(param, "rake");

        document.getElementById("rake").selectedIndex = 0;
        setValueOnChange('/calcEV/setRake', 'rake', document.getElementById("rake"));
    });

    function getData(url, callback) {
        let request = new XMLHttpRequest();
        request.onreadystatechange = () => {
            if (request.readyState === XMLHttpRequest.DONE) {
                if (request.status === 200) {
                    let data = JSON.parse(request.responseText);
                    callback(data);
                } else {
                    console.error('Error received ' + url + ": ", request.status);
                }
            }
        };
        request.open('GET', url, true);
        request.send();
    }

    function listElements(data, id) {
        let element = document.getElementById(id);
        data.forEach(item => {
            let option = document.createElement("option");
            option.value = item;
            option.textContent = item;
            element.appendChild(option);
        });
    }

    function setValueOnChange(request, requestParam, value) {
        let url = `${request}?${requestParam}=${encodeURIComponent(value.value)}`;

        fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        })
            .then(() => {
                getValue('/calcEV/hyperEV', 'hyperEV');
                getValue('/calcEV/evTotal', 'evTotal');
            });
    }

    function setValueOnInput(id, request, requestParam) {
        let value = document.getElementById(id).value;
        if (value.trim() !== '' && /^\d*\.?\d*$/.test(value)) {
            let form = new FormData();
            form.append(requestParam, value);

            fetch(request, {
                method: 'POST',
                body: form
            }).then(() => {
                getValue('/calcEV/hyperEV', 'hyperEV');
                getValue('/calcEV/evTotal', 'evTotal');
            });
        }
    }

    document.addEventListener("DOMContentLoaded", () => {
        getValue('/calcEV/hyperEV', 'hyperEV');
        getValue('/calcEV/evTotal', 'evTotal');
    });

    function getValue(request, id) {
        fetch(request)
            .then(response => response.text())
            .then(data => {
                document.getElementById(id).value = data;
            })
            .catch(error => {
                console.error('Error received: ', error);
            });
    }

</script>
</body>
</html>
